# CLAUDE.md — Engineering Governance & Technical Standards

**Project:** OttieVerse
**Role:** Staff Full-Stack Engineer / Mobile Architect
**Enforcement Level:** STRICT / BLOCKING
**Target Agent:** Claude / AI Contributors

---

## 1. Protocol Zero: No-AI Attribution (HIGHEST PRIORITY)

### 1.1 Zero Tolerance Policy

AI agents are strictly **FORBIDDEN** from leaving evidence of machine generation in the codebase, data models, or documentation.

- **Forbidden Phrases:** "Generated by AI", "As an AI", "I have updated", "Based on the design doc", "LLM-optimized".
- **Forbidden Artifacts:** AI-typical conversational filler, apologetic preambles, or "scaffolding" comments.
- **Forbidden Metadata:** `Co-authored-by` headers referencing AI or specific model names.

### 1.2 Output Sanitization

- **Voice:** Cold, precise, technical, and authoritative.
- **Commits:** MUST follow the imperative mood (e.g., "Add scene transition animation to welcome screen").
- **Documentation:** Write as a Staff Engineer documenting production mobile infrastructure. No narrative fluff.

---

## 2. Authority & Governance

1. **Supreme Law:** This `CLAUDE.md` file is the highest authority in the repository.
2. **Architecture Alignment:** All changes MUST align with the Scene Architecture (linear state machine, static export, Capacitor native shell) defined in `DESIGN_DOC.md`.
3. **Refusal Policy:** If a request violates these standards or the architecture in `DESIGN_DOC.md`, the agent MUST halt and reject the request with a specific technical justification.

---

## 3. Claude Skills Infrastructure (MANDATORY)

### 3.1 Skills as First-Class Primitives

Skills are **mandatory infrastructure** in this repository. They extend Claude's capabilities with specialized knowledge, workflows, and tooling.

**Governing Principles:**

- All skills MUST reside under `.claude/skills/`
- Only Anthropic-compliant skill structures are permitted
- No JSON, YAML-only, or custom skill formats
- Skills are loaded at session start; metadata is always in context

### 3.2 Mandatory Skill Creator Usage

When creating or modifying any skill, Claude Code MUST:

1. **Invoke the Skill Creator skill** (`/skill-creator` or automatic trigger)
2. **Use the initialization script**: `python .claude/skills/skill-creator/scripts/init_skill.py <skill-name> --path .claude/skills`
3. **Follow the six-step process** defined in `.claude/skills/skill-creator/SKILL.md`
4. **Validate before completion**: `python .claude/skills/skill-creator/scripts/validate_skill.py <path/to/skill>`

**Absolute Prohibitions:**

- ❌ Hand-writing skill folder structures without using `init_skill.py`
- ❌ Inventing custom skill formats or schemas
- ❌ Creating skills outside `.claude/skills/`
- ❌ Bypassing the Skill Creator workflow
- ❌ Creating skills if Skill Creator is unavailable (HALT and report)

### 3.3 Valid Skill Structure (Anthropic Standard)

Every skill MUST conform to this structure:

```md
.claude/skills/<skill-name>/
├── SKILL.md (REQUIRED)
│ ├── YAML frontmatter (name, description — REQUIRED)
│ └── Markdown body (instructions — REQUIRED)
└── Bundled Resources (OPTIONAL)
├── scripts/ (executable code)
├── references/ (documentation)
└── assets/ (templates, files)
```

**SKILL.md Requirements:**

- MUST begin with YAML frontmatter (`---` delimiters)
- MUST contain `name` field (lowercase, hyphens only)
- MUST contain `description` field (≥50 characters, no TODOs)
- MUST NOT exceed 500 lines
- MUST use imperative voice

### 3.4 Invalid Skill Definitions (Reject Immediately)

A skill is **invalid** and MUST be rejected if:

- Missing `SKILL.md` file
- Missing or malformed YAML frontmatter
- `name` or `description` fields absent
- Description contains placeholder text (TODO, TBD, etc.)
- Description under 50 characters
- SKILL.md exceeds 500 lines
- Contains forbidden auxiliary files: `README.md`, `CHANGELOG.md`, `INSTALLATION_GUIDE.md`
- Located outside `.claude/skills/`
- Uses non-standard structure (JSON configs, YAML-only definitions)

### 3.5 Enforcement Workflow

**For New Skills:**

1. Invoke Skill Creator skill
2. Run `init_skill.py` to scaffold
3. Implement SKILL.md and resources
4. Run `validate_skill.py` — MUST pass
5. Commit only after validation succeeds

**For Skill Modifications:**

1. Read existing skill structure
2. Follow Skill Creator guidelines
3. Run `validate_skill.py` after changes
4. Commit only after validation succeeds

**CI/PR Integration:**

- PRs containing manually created skills (not via Skill Creator) are subject to rejection
- `protocol-zero.sh` may validate skill structure in pre-commit hooks
- Invalid skills block merge

### 3.6 Installed Skills Registry

| Skill                | Path                                 | Purpose                                  |
| -------------------- | ------------------------------------ | ---------------------------------------- |
| `skill-creator`      | `.claude/skills/skill-creator/`      | Meta-skill for creating compliant skills |
| `typescript-writing` | `.claude/skills/typescript-writing/` | Production-grade TypeScript generation   |
| `tailwind-writing`   | `.claude/skills/tailwind-writing/`   | High-polish Tailwind v4 generation       |
| `motion-engineering` | `.claude/skills/motion-engineering/` | Physics-based animation & interaction    |
| `mobile-native`      | `.claude/skills/mobile-native/`      | iOS fidelity & Capacitor standards       |
| `react-architecture` | `.claude/skills/react-architecture/` | React 19 & Next.js 16 component patterns |
| `epic-writer`        | `.claude/skills/epic-writer/`        | Phase-to-Epic generation                 |

**Usage:**

- Invoke directly: `/skill-creator`, `/typescript-writing`, `/tailwind-writing`, `/motion-engineering`, `/mobile-native`, `/react-architecture`, `/epic-writer`
- Automatic activation based on description triggers

---

## 4. TypeScript Writing Skill Enforcement (MANDATORY)

### 4.1 Skill Requirement

Claude Code MUST use the `typescript-writing` skill for **ALL TypeScript code generation**.

**This applies to:**

- New `.ts` or `.tsx` files
- Modifications to existing `.ts` or `.tsx` files
- Component definitions and hooks
- Type definitions and utility modules
- Any TypeScript code operation within the repository

### 4.2 Mandatory Compliance

When writing TypeScript, Claude Code MUST:

1. **Activate the typescript-writing skill** (automatic or `/typescript-writing`)
2. **Follow all standards** defined in `.claude/skills/typescript-writing/SKILL.md`
3. **Output complete, compilable code** — no placeholders or `TODO` stubs
4. **Use discriminated unions** for all multi-state objects
5. **Use `readonly` by default** for all properties and parameters
6. **Use `import type`** for all type-position-only imports
7. **Include TSDoc** on all exported symbols

### 4.3 Absolute Prohibitions

- ❌ Writing TypeScript without the `typescript-writing` skill active
- ❌ Using `any` (explicit or implicit)
- ❌ Using `@ts-ignore` without a linked issue justification
- ❌ Using `var` declarations
- ❌ Using `enum` (runtime enums) — use `as const` unions
- ❌ Using `React.FC` or `React.forwardRef` (deprecated in React 19)
- ❌ Leaving floating promises unhandled
- ❌ Using `useEffect` for derived state
- ❌ Omitting `assertNever` default branches on discriminated union switches
- ❌ Bypassing the skill for "quick fixes"

### 4.4 Enforcement

**If the typescript-writing skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with TypeScript generation

**Manual TypeScript writing outside this skill constitutes a governance violation.**

### 4.5 Validation Requirements

All TypeScript code MUST pass:

```bash
npx biome check .
```

Code that fails Biome checks is rejected. Zero diagnostics required.

---

## 5. UI/UX & Tailwind Enforcement (MANDATORY)

### 5.1 Skill Requirement

Claude Code MUST use the `tailwind-writing` skill for **ALL styling and CSS operations**.

**This applies to:**

- Writing or modifying `className` attributes in JSX/TSX files
- Modifying `globals.css` or any `.css` file
- Creating or updating UI components
- Applying design tokens, colors, spacing, or typography
- Any visual styling decision within the repository

### 5.2 Mandatory Compliance

When writing styling code, Claude Code MUST:

1. **Activate the tailwind-writing skill** (automatic or `/tailwind-writing`)
2. **Follow all standards** defined in `.claude/skills/tailwind-writing/SKILL.md`
3. **Use semantic design tokens** from `@theme` — no hardcoded hex in `className`
4. **Use `clsx`** for conditional class composition — no template string interpolation
5. **Include `focus-visible:` states** on all interactive elements
6. **Wrap motion utilities** in `motion-safe:` / `motion-reduce:` prefixes
7. **Meet WCAG AA contrast** (4.5:1 body text, 3:1 large text and UI elements)
8. **Use `min-h-dvh`** instead of `min-h-screen` for mobile viewports

### 5.3 Visual Quality Standard

All UI output MUST meet the "Senior Designer at Linear or Apple" standard:

- **Intentional whitespace** — generous padding and spacing, never cramped
- **Subtle borders** — `border-border-subtle` for cards, `border-border-default` for interactive elements
- **Restrained shadows** — `shadow-sm` for cards, `shadow-lg` for modals, never `shadow-2xl` everywhere
- **Typographic hierarchy** — maximum 3 font weights per view, tight tracking on headings
- **Scene palette adherence** — gradients and colors MUST match DESIGN_DOC.md Section 6 exactly

### 5.4 Absolute Prohibitions

- `@apply` in CSS files (utility-first strictness)
- Arbitrary pixel values (`p-[17px]`) where the spacing scale suffices
- Hardcoded hex colors in `className` (`bg-[#ff0000]`)
- Missing `focus-visible:` rings on interactive elements
- `dark:` variants (this app uses scene-specific palettes, not dark mode)
- `!important` or `!` prefix utilities
- Inline `style={{ }}` for Tailwind-solvable styles
- `opacity-*` as a standalone utility (use `/50` modifier syntax)

### 5.5 Enforcement

**If the tailwind-writing skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with styling work

**Manual styling outside this skill constitutes a governance violation.**

---

## 6. Animation & Interaction Enforcement (MANDATORY)

### 6.1 Skill Requirement

Claude Code MUST use the `motion-engineering` skill for **ALL animations, transitions, gesture handling, and interactive motion**.

**This applies to:**

- Scene transitions (`AnimatePresence`, entry/exit animations)
- Component animations (`motion.*` elements, spring configurations)
- Gesture handlers (`whileTap`, `whileHover`, drag interactions)
- Layout animations (`layout`, `layoutId`, shared element transitions)
- Staggered children (quiz options, sequential reveals)
- Haptics synchronization with visual feedback
- Any use of the `motion` library within the repository

### 6.2 Mandatory Compliance

When writing animation code, Claude Code MUST:

1. **Activate the motion-engineering skill** (automatic or `/motion-engineering`)
2. **Follow all standards** defined in `.claude/skills/motion-engineering/SKILL.md`
3. **Use spring physics** for all transform animations — no `duration`/`ease` on interactive UI
4. **Reference named `SPRING.*` presets** — no inline magic numbers for stiffness/damping
5. **Animate GPU-accelerated properties only** (`x`, `y`, `scale`, `opacity`, `rotate`)
6. **Wrap conditional renders in `AnimatePresence`** with `exit` props
7. **Use `mode="wait"`** for scene transitions per DESIGN_DOC.md Section 4
8. **Fire haptics in event handlers** — not in `onAnimationComplete`

### 6.3 Absolute Prohibitions

- ❌ Writing animations without the `motion-engineering` skill active
- ❌ Using `duration`/`ease` on transform properties (`x`, `y`, `scale`, `rotate`)
- ❌ Inline spring values without named presets
- ❌ Animating layout-triggering properties (`width`, `height`, `top`, `left`, `margin`)
- ❌ Manual `will-change: transform` declarations (Motion handles GPU promotion)
- ❌ Missing `exit` props on conditionally rendered `motion.*` elements
- ❌ `whileTap` scale values outside 0.95–0.97 range
- ❌ Importing from `framer-motion` instead of `motion/react`
- ❌ Using `useAnimation()` instead of `useAnimationControls()`
- ❌ Haptics tied to animation callbacks instead of interaction events

### 6.4 Enforcement

**If the motion-engineering skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with animation work

**Manual animation code outside this skill constitutes a governance violation.**

---

## 7. Mobile Fidelity Enforcement (MANDATORY)

### 7.1 Skill Requirement

Claude Code MUST use the `mobile-native` skill for **ALL layout, viewport, scroll, input, and touch interaction code**.

**This applies to:**

- Viewport and safe area configuration
- Scene container layouts and height calculations
- Scroll behavior and overscroll control
- Text selection policy (global disable, selective enable)
- Touch target sizing and haptic feedback wiring
- Input field styling and iOS default removal
- Any CSS resets targeting browser behavior

### 7.2 Mandatory Compliance

When writing layout or interaction code, Claude Code MUST:

1. **Activate the mobile-native skill** (automatic or `/mobile-native`)
2. **Follow all standards** defined in `.claude/skills/mobile-native/SKILL.md`
3. **Use `dvh` viewport units** — zero instances of `vh` or Tailwind `screen`
4. **Apply safe area insets** via `env()` on all full-screen containers
5. **Ensure every tappable element fires haptic feedback** via `@/lib/haptics`
6. **Set `type="button"`** on all non-submit buttons
7. **Meet 44x44pt minimum** on all touch targets (Apple HIG)

### 7.3 The App Test

> If it feels like a website, it is a failure.

The WebView is a rendering surface — not a browser. The app must be indistinguishable from a native Swift implementation. Browser artifacts (tap highlights, rubber-banding, text selection handles, form field chrome) are blocking defects.

### 7.4 Absolute Prohibitions

- `alert()`, `confirm()`, or `prompt()` (use custom UI)
- `100vh`, `h-screen`, `min-h-screen` (use `dvh` equivalents)
- `overflow: auto` on `body` or `html` (use explicit scroll containers)
- Direct `@capacitor/haptics` imports in components (use `@/lib/haptics`)
- `font-size` below 16px on text inputs (triggers iOS zoom)
- Missing haptic feedback on interactive elements
- `user-select: auto` on UI chrome (global `none`, opt-in `text`)
- Body scroll (body is `position: fixed`)

### 7.5 Enforcement

**If the mobile-native skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with layout or interaction work

**Manual layout or interaction code outside this skill constitutes a governance violation.**

---

## 8. Component Architecture Enforcement (MANDATORY)

### 8.1 Skill Requirement

Claude Code MUST use the `react-architecture` skill for **ALL component, hook, context, and state management code**.

**This applies to:**

- Creating or modifying React components (`.tsx` files)
- Writing custom hooks (`use*.ts` files)
- Creating or consuming Context providers
- State management decisions (`useState` vs `useReducer`)
- Component decomposition and file organization
- Event handler patterns and prop design

### 8.2 Mandatory Compliance

When writing component or hook code, Claude Code MUST:

1. **Activate the react-architecture skill** (automatic or `/react-architecture`)
2. **Follow all standards** defined in `.claude/skills/react-architecture/SKILL.md`
3. **Separate logic from UI** — logic in custom hooks, rendering in components
4. **Use `useReducer`** for all interdependent or state-machine state
5. **Use compound components** when a feature has 3+ sub-parts sharing state
6. **Use `use()` hook** to read context (not `useContext()`) and `<Context value={}>` (no `.Provider`)
7. **Limit component size** — 150 lines target, 200 lines hard maximum
8. **Prevent prop drilling** — maximum 2 levels without context

### 8.3 Absolute Prohibitions

- ❌ Writing components or hooks without the `react-architecture` skill active
- ❌ God components exceeding 200 lines
- ❌ Prop drilling beyond 2 component boundaries
- ❌ `useState` spaghetti for interdependent state (use `useReducer`)
- ❌ `useEffect` for derived state (compute during render)
- ❌ `defaultProps` (use default parameter values)
- ❌ `React.FC` or `React.forwardRef` (deprecated React 19 patterns)
- ❌ `useContext()` in new code (use `use()` hook)
- ❌ `<Context.Provider>` syntax (use `<Context value={}>`)
- ❌ Side effects in reducer functions
- ❌ `'use client'` on `page.tsx` or `layout.tsx`

### 8.4 Enforcement

**If the react-architecture skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with component or hook creation

**Manual component architecture outside this skill constitutes a governance violation.**

---

## 9. Planning & Epic Enforcement (MANDATORY)

### 9.1 Skill Requirement

Claude Code MUST use the `epic-writer` skill for **ALL planning, phase decomposition, and Epic generation work**.

**This applies to:**

- Decomposing execution phases from `docs/PHASES.md` into engineering work items
- Creating Epics, stories, or acceptance criteria for implementation tasks
- Translating architectural specifications into actionable tickets
- Sprint planning and backlog generation
- Any planning activity that produces work items for implementation

### 9.2 Mandatory Compliance

When generating planning artifacts, Claude Code MUST:

1. **Activate the epic-writer skill** (automatic or `/epic-writer`)
2. **Follow all standards** defined in `.claude/skills/epic-writer/SKILL.md`
3. **Read `docs/PHASES.md`** to extract the phase definition before generating any Epic
4. **Cross-reference `DESIGN_DOC.md`** for all technical specifications (animation values, haptic events, color tokens, typography, asset paths)
5. **Use the strict Epic template** from `.claude/skills/epic-writer/assets/epic-template.md`
6. **Save output to `docs/<PH-ID>/`** with lowercase-hyphenated filenames

### 9.3 Zero Ambiguity Rule

Epics MUST define the _how_, not just the _what_:

- Every file path MUST reference a real path from the Project Structure or Phase-to-File Mapping
- Every animation value MUST be sourced from DESIGN_DOC.md
- Every haptic event MUST match DESIGN_DOC.md Section 7
- Every color token MUST reference a CSS custom property from DESIGN_DOC.md Section 6
- Every story MUST have Gherkin acceptance criteria (Given/When/Then)
- If DESIGN_DOC.md is silent on a detail, insert a `[BLOCKER]` tag — do not invent values

### 9.4 Absolute Prohibitions

- "TBD", "TODO", or placeholder text in any Epic field
- Generic stories without testable acceptance criteria
- Referencing files outside the Phase-to-File Mapping without justification
- Including work from adjacent phases (strict scope boundaries)
- Inventing animation values, haptic patterns, or color tokens not in DESIGN_DOC.md
- Producing Epics without reading both `docs/PHASES.md` and `DESIGN_DOC.md` first

### 9.5 Enforcement

**If the epic-writer skill is unavailable:**

- HALT immediately
- Report the skill is missing
- Do NOT proceed with planning or Epic generation

**Manual Epic or story creation outside this skill constitutes a governance violation.**

---

## 10. Engineering Standards: App Stack

### 10.1 Next.js & React

- **Version:** Next.js 16.1 (pinned). Do NOT use `@latest`. Do NOT upgrade without explicit instruction.
- **Runtime:** React 19.x. Leverage concurrent features and the `use` hook where appropriate.
- **Language:** TypeScript 5.7+ in strict mode. Zero tolerance for `any`.
- **Export:** Static Export (`output: 'export'`) ONLY. This is a Capacitor app served from disk. No SSR, no API routes, no middleware.
- **Routing:** Single-page app. All scenes render within `src/app/page.tsx`, orchestrated by a client-side state machine. No file-based routing beyond the root page.
- **Rendering:** No `useEffect` where pure rendering, event handlers, or derived state suffice. Prefer computed values over synchronized state.

### 10.2 Styling (Tailwind CSS 4)

- **Config:** Zero-config, CSS-first approach. Global import via `@import "tailwindcss"` in `globals.css`. No `tailwind.config.ts` unless `@theme` overrides are required.
- **Methodology:** Utility-first ONLY.
- **Ban:** `@apply` in CSS files is FORBIDDEN. Compose utilities in JSX. The only exception is `@theme` blocks for custom design tokens.
- **Class Sorting:** Enforce via Biome or Prettier plugin. Unsorted class strings are a review blocker.
- **Design Tokens:** Scene-specific color palettes and typography MUST reference the Visual Design System in `DESIGN_DOC.md` Section 6. No ad-hoc color values.

### 10.3 Animation (Motion)

- **Library:** `motion` (Framer Motion) v12.34+. Import from `motion/react`.
- **Transitions:** All scene transitions MUST use `AnimatePresence` with `mode="wait"`.
- **Physics:** Use spring-based animations with explicit `stiffness` and `damping` values. No magic numbers.
- **Performance:** Target 60fps minimum. No layout-triggering animations (avoid animating `width`, `height`, `top`, `left`). Prefer `transform` and `opacity`.

### 10.4 Mobile Native (Capacitor 8)

- **Sync:** `npx cap sync` MUST run after every `pnpm build`. The `out/` directory is the sole web asset source.
- **Haptics:** Use the abstraction layer in `src/lib/haptics.ts` ONLY. Direct imports from `@capacitor/haptics` in components are FORBIDDEN.
- **Platform Check:** All native API calls MUST be gated behind `Capacitor.isNativePlatform()`. The app must remain functional in a browser for development.
- **Assets:** Reference otter images via `/otters/<filename>.png`. All 12 assets are defined in the Asset Manifest (`DESIGN_DOC.md` Section 11). No raw asset paths outside `public/otters/`.
- **iOS Config:** `contentInset: 'always'` is required. Do not modify `capacitor.config.ts` without architectural review.

### 10.5 Type Safety & Linting

- **Tool:** Biome 2.3+ (replaces ESLint and Prettier). Single toolchain for linting, formatting, and import organization.
- **BLOCKING Rules:**
  - `noExplicitAny`: ERROR. Zero `any` types permitted.
  - `noUnusedVariables`: ERROR. Dead code is a merge blocker.
  - `noUnusedImports`: ERROR. Clean imports at all times.
  - `noNonNullAssertion`: ERROR. No `!` postfix assertions.
- **Formatter:** 2-space indent, 100 char line width, double quotes.
- **CSS:** `tailwindDirectives: true` MUST be enabled in `biome.json` to parse `@import "tailwindcss"`.
- **Validation:** `npx biome check .` MUST pass with zero errors before any commit.

### 10.6 Package Management

- **Manager:** pnpm 9.x. No npm, no yarn.
- **Pinning:** All dependencies MUST remain at the versions specified in `DESIGN_DOC.md` Section 10. Do NOT upgrade packages unless explicitly instructed.
- **Node:** Node.js 22 LTS required.

---

## 11. LLM / Agent Rules (Critical)

### 11.1 Modification Discipline

- **No Silent Refactors:** Do not "clean up" components, styles, or utilities outside the requested scope. Touch only what is asked.
- **Architecture Protection:** Agents are FORBIDDEN from altering the scene state machine order, the Capacitor config, or the static export pipeline without explicit architectural review.
- **Dependency Management:** All packages MUST remain at pinned versions. Do not upgrade, add, or remove dependencies unless instructed.
- **Skill Compliance:** All skill operations MUST use the Skill Creator skill. All TypeScript operations MUST use the typescript-writing skill. All styling operations MUST use the tailwind-writing skill. All animations MUST use the motion-engineering skill. All component/hook creation MUST use the react-architecture skill. No exceptions.

### 11.2 Research & Verification

- Before utilizing a React API, Motion prop, or Capacitor plugin, verify its availability in the pinned versions.
- **No Guessing:** If a scene specification, animation value, or asset reference is ambiguous, STOP and request clarification.
- **Design Doc is Law:** All scene behavior, haptic patterns, animation specs, and visual design tokens are defined in `DESIGN_DOC.md`. Do not invent values.

---

## 12. Safety & Reliability

### 12.1 Build Requirements

- `pnpm build` MUST produce a clean static export in `out/` with zero errors.
- `npx biome check .` MUST pass with zero diagnostics.
- TypeScript compilation MUST succeed with zero errors under strict mode.

### 12.2 Runtime Safety

- **No Network Dependency:** The app is fully offline. No fetch calls, no external APIs, no CDN references. Everything ships in the bundle.
- **No Persistence:** No localStorage, no cookies, no IndexedDB. Single-use forward-only experience.
- **Fail-Safe Interactions:** Every scene MUST be completable. No dead ends, no unrecoverable error states.

---

## 13. Repository Workflow

### 13.1 GitHub Repository Configuration

**Repository:** `dinesh-git17/ottieverse`
**Visibility:** Public
**Default Branch:** `main`

**Enabled Features:**

- Issues (required for all work items)
- Dependabot security alerts
- Secret scanning with push protection

**Disabled Features:**

- Wiki (documentation lives in-repo)
- Merge commits (squash only)
- Rebase merges (squash only)

### 13.2 Branch Protection Rules (main)

The `main` branch enforces strict protection:

| Rule                            | Setting                |
| ------------------------------- | ---------------------- |
| Require pull request            | Yes                    |
| Required approving reviews      | 1                      |
| Dismiss stale reviews           | Yes                    |
| Require CODEOWNER review        | Yes                    |
| Require status checks to pass   | Yes                    |
| Require branches up-to-date     | Yes                    |
| Require conversation resolution | Yes                    |
| Require linear history          | Yes                    |
| Allow force pushes              | No                     |
| Allow deletions                 | No                     |
| Admin bypass                    | Yes (code owners only) |

**Required Status Checks (must pass before merge):**

- `build` — `pnpm build` static export
- `lint` — `npx biome check .`
- `protocol-zero` — Governance AI attribution scan

### 13.3 Merge Strategy

- **Squash merge only** — All PRs squash to single commit
- **Commit title:** PR title (imperative mood)
- **Commit body:** PR description
- **Auto-delete branches:** Enabled after merge

### 13.4 Branching Convention

**Format:** `<type>/<short-description>`

**Types:**

| Type       | Purpose                      |
| ---------- | ---------------------------- |
| `feat`     | New feature or capability    |
| `fix`      | Bug fix                      |
| `refactor` | Code restructuring           |
| `docs`     | Documentation changes        |
| `test`     | Test additions/modifications |
| `chore`    | Build, CI, or tooling        |

**Examples:**

- `feat/welcome-scene`
- `fix/quiz-answer-validation`
- `refactor/scene-transition-logic`
- `chore/capacitor-ios-setup`

### 13.5 Commit Messages

**Format:** `type(scope): imperative description`

**Scopes:** `scene`, `ui`, `lib`, `config`, `assets`, `ci`, `docs`, `skills`

**Examples:**

- `feat(scene): add quiz with 5-question trivia flow`
- `fix(ui): correct otter sprite frame timing`
- `feat(lib): add haptics abstraction for capacitor`
- `chore(config): pin next.js to 16.1.0`
- `feat(assets): add otter celebration sprite`
- `feat(skills): add typescript-writing skill for code generation standards`

### 13.6 Issue Management

**All work MUST begin with an issue.** No direct commits without issue linkage.

**Issue Templates:**

| Template        | Purpose                                 | Auto-Labels             |
| --------------- | --------------------------------------- | ----------------------- |
| Bug Report      | Defects in scenes, animations, or build | `bug`, `triage`         |
| Feature Request | New scenes, components, or enhancements | `enhancement`, `triage` |

**Bug Report Required Fields:**

- Summary (one-sentence)
- Expected vs. Actual behavior
- Reproduction steps
- Environment (iOS version, device, browser if applicable)
- Severity classification (Critical/High/Medium/Low)

**Feature Request Required Fields:**

- Problem statement
- Proposed solution
- Alternatives considered
- Design Doc section reference
- Acceptance criteria

**Blank issues are disabled.** All issues MUST use a template.

### 13.7 Pull Request Workflow

**PR Template enforces governance compliance.** All sections MUST be completed.

**Required PR Sections:**

1. **Description** — Concise summary and motivation
2. **Linked Issue** — `Closes #<issue-number>` (mandatory)
3. **Change Type** — Single selection from conventional commit types
4. **Design Impact** — Scene affected, animation changes, haptic changes
5. **Testing Evidence** — Build output, Biome check output, device/simulator test
6. **Risk Assessment** — Low/Medium/High with rollback plan
7. **Governance Checklist** — CLAUDE.md Section 15 compliance verification

**PR Lifecycle:**

```
Issue Created → Branch Created → Development → PR Opened → CI Passes → Review → Squash Merge → Branch Deleted
```

**CI/CD Gate:** GitHub Actions is the source of truth. A task is NOT complete until all required checks pass.

### 13.8 Label System

**Category Labels:**

| Label             | Color     | Description                                |
| ----------------- | --------- | ------------------------------------------ |
| `bug`             | `#D73A4A` | Defect requiring correction                |
| `enhancement`     | `#0E8A16` | New feature or capability                  |
| `docs`            | `#1D76DB` | Documentation improvements                 |
| `refactor`        | `#FBCA04` | Code restructuring without behavior change |
| `chore`           | `#FEF2C0` | Maintenance and tooling tasks              |
| `ci`              | `#5319E7` | Continuous integration and deployment      |
| `security`        | `#B60205` | Security vulnerability or hardening        |
| `breaking-change` | `#E99695` | Backwards-incompatible modification        |

**Priority Labels:**

| Label             | Color     | Description                    |
| ----------------- | --------- | ------------------------------ |
| `priority:high`   | `#FF0000` | Critical — immediate attention |
| `priority:medium` | `#FF9500` | Standard — scheduled work      |
| `priority:low`    | `#0E8A16` | Backlog item                   |

### 13.9 Security Configuration

**Enabled Protections:**

- Dependabot vulnerability alerts
- Dependabot automated security updates
- Secret scanning (all commits)
- Push protection (blocks secrets before push)
- Dependency graph analysis

**Actions Security:**

- All third-party actions pinned to SHA
- Read-only tokens by default
- Workflow permissions minimized

### 13.10 CODEOWNERS

```
# Default owner for all files
* @dinesh-git17
```

All PRs require CODEOWNER approval. CODEOWNERS may bypass protections for emergency fixes.

---

## 14. Performance Expectations

### 14.1 Build & Bundle

- **First Contentful Paint:** < 1.0s
- **Bundle Size (gzipped):** < 150kb (excluding images)
- **Otter Images:** < 200kb each (compressed PNG)
- **Total Asset Payload:** < 3MB

### 14.2 Runtime

- **Animation Framerate:** 60fps minimum. No dropped frames during scene transitions.
- **Haptic Latency:** Haptic feedback MUST fire within the same event loop tick as the triggering interaction.
- **No Jank:** Layout shifts during transitions are a blocking defect.

---

## 15. Definition of Done (Checklist)

An agent may only declare a task complete if:

- [ ] `pnpm build` passes with zero errors (static export to `out/`).
- [ ] `npx biome check .` passes with zero diagnostics.
- [ ] No `any` types exist in the codebase.
- [ ] No unused variables or imports exist.
- [ ] All components render without runtime errors.
- [ ] Scene behavior matches `DESIGN_DOC.md` specification exactly.
- [ ] Haptics use `src/lib/haptics.ts` abstraction only.
- [ ] Assets reference `public/otters/` manifest only.
- [ ] Animations target 60fps (no layout-triggering properties).
- [ ] No network calls, no external dependencies at runtime.
- [ ] No AI-attribution breadcrumbs exist in the code or comments.
- [ ] Commit message follows the Conventional Commits standard.
- [ ] `./tools/protocol-zero.sh` passes with zero violations.
- [ ] **Skills created via Skill Creator workflow** (if applicable).
- [ ] **Skills validated via `validate_skill.py`** (if applicable).
- [ ] **No manually constructed skill structures exist**.
- [ ] **TypeScript generated via `typescript-writing` skill** (if applicable).
- [ ] **All exported symbols have TSDoc** (if applicable).
- [ ] **All state modeled as discriminated unions** (if applicable).
- [ ] **Styling generated via `tailwind-writing` skill** (if applicable).
- [ ] **All colors use semantic tokens or Tailwind palette** (if applicable).
- [ ] **All interactive elements have `focus-visible:` states** (if applicable).
- [ ] **No `@apply`, arbitrary pixels, or hardcoded hex in `className`** (if applicable).
- [ ] **Animations generated via `motion-engineering` skill** (if applicable).
- [ ] **All transform animations use spring physics** (no `duration`/`ease`) (if applicable).
- [ ] **All spring values reference named `SPRING.*` presets** (if applicable).
- [ ] **All conditional renders wrapped in `AnimatePresence` with `exit` props** (if applicable).
- [ ] **Layout generated via `mobile-native` skill** (if applicable).
- [ ] **All viewport heights use `dvh` — zero `vh` or `screen` units** (if applicable).
- [ ] **Safe area insets applied via `env()` on scene containers** (if applicable).
- [ ] **Global CSS includes tap highlight, callout, overscroll, and selection resets** (if applicable).
- [ ] **Every tappable element fires haptic feedback** (if applicable).
- [ ] **All touch targets meet 44x44pt minimum** (if applicable).
- [ ] **Components generated via `react-architecture` skill** (if applicable).
- [ ] **Complex state uses `useReducer` with discriminated unions** (if applicable).
- [ ] **Logic separated into custom hooks; components are pure rendering** (if applicable).
- [ ] **No component file exceeds 200 lines** (if applicable).
- [ ] **No prop drilling beyond 2 levels** (if applicable).
- [ ] **Context uses React 19 syntax: `<Context value={}>` and `use()` hook** (if applicable).
- [ ] **Epics generated via `epic-writer` skill** (if applicable).
- [ ] **All Epics saved to `docs/<PH-ID>/` with lowercase-hyphenated filenames** (if applicable).
- [ ] **Zero "TBD" or "TODO" placeholders in Epic fields** (if applicable).
- [ ] **Every story has Gherkin acceptance criteria (Given/When/Then)** (if applicable).
- [ ] **All technical values sourced from DESIGN_DOC.md — no invented specs** (if applicable).

---

## 16. Final Acknowledgment

Execution of any task within this repository constitutes a binding agreement to these standards. Failure to comply results in immediate work rejection and mandatory rollback.

**Architecture Enforcement Clause:** The scene state machine order (WELCOME → QUIZ → WORD_SEARCH → POETRY_CANVAS → LETTER → THE_ASK) is immutable. Any attempt to reorder, skip, or add back-navigation is a governance violation requiring architectural review.

**Static Export Clause:** Any attempt to introduce SSR, API routes, middleware, or server-side data fetching is a governance violation. This is a static Capacitor app. All logic runs client-side.

**Dependency Clause:** Any attempt to add, remove, or upgrade dependencies without explicit instruction is a governance violation. The stack defined in `DESIGN_DOC.md` Section 10 is ratified and locked.

**Skills Enforcement Clause:** Any attempt to create, modify, or propose skills outside the Skill Creator workflow is a governance violation. Claude Code MUST refuse such requests and redirect to the proper workflow.

**TypeScript Enforcement Clause:** Any attempt to write TypeScript code without the `typescript-writing` skill active is a governance violation. Claude Code MUST activate the skill before generating any `.ts` or `.tsx` output. All TypeScript MUST comply with the strict typing, immutability, error handling, and React 19 patterns defined in `.claude/skills/typescript-writing/SKILL.md`.

**Tailwind Enforcement Clause:** Any attempt to write styling code without the `tailwind-writing` skill active is a governance violation. Claude Code MUST activate the skill before generating any `className`, CSS, or styling output. All styling MUST comply with the semantic tokens, accessibility, anti-slop rules, and Tailwind v4 patterns defined in `.claude/skills/tailwind-writing/SKILL.md`.

**Motion Engineering Enforcement Clause:** Any attempt to write animation, transition, or gesture code without the `motion-engineering` skill active is a governance violation. Claude Code MUST activate the skill before generating any `motion.*` elements, spring configurations, or `AnimatePresence` wrappers. All animations MUST use spring physics for transform properties, reference named `SPRING.*` presets, animate GPU-accelerated properties only, and synchronize haptics in event handlers per `.claude/skills/motion-engineering/SKILL.md`.

**Mobile Fidelity Enforcement Clause:** Any attempt to write layout, viewport, scroll, input, or touch interaction code without the `mobile-native` skill active is a governance violation. Claude Code MUST activate the skill before generating any scene containers, scroll regions, input fields, or touch handlers. All layouts MUST use `dvh` viewport units, apply safe area insets via `env()`, disable browser defaults globally, and wire haptic feedback on every interactive element per `.claude/skills/mobile-native/SKILL.md`.

**React Architecture Enforcement Clause:** Any attempt to create components, hooks, context providers, or state management code without the `react-architecture` skill active is a governance violation. Claude Code MUST activate the skill before generating any `.tsx` component, custom hook, or context provider. All components MUST separate logic into hooks, use `useReducer` for interdependent state, apply compound component patterns for multi-part features, limit files to 200 lines, prevent prop drilling beyond 2 levels, and use React 19 context syntax (`<Context value={}>`, `use()` hook) per `.claude/skills/react-architecture/SKILL.md`.

**Epic Writer Enforcement Clause:** Any attempt to decompose phases, generate Epics, create stories, or produce planning artifacts without the `epic-writer` skill active is a governance violation. Claude Code MUST activate the skill before generating any work items. All Epics MUST follow the strict template in `.claude/skills/epic-writer/assets/epic-template.md`, cross-reference both `docs/PHASES.md` and `DESIGN_DOC.md`, contain zero placeholder text, include Gherkin acceptance criteria on every story, and be saved to `docs/<PH-ID>/` per `.claude/skills/epic-writer/SKILL.md`.
